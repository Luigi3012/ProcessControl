<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name='viewport' content='initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no'>
    <script src="./JSBridge.js"></script>
    <link rel="stylesheet" type="text/css" href="styles/main.css">
</head>
<body onload="init()">
	<script>
        // Temporary for evaluation purposes
        var dataObj = {
            entity: "Account",
            field: "dealprogress",
            optionSet: [ {id: 1, text: "Contact lead", desc: "bkajksjfhjkhs", state: 2}, {id: 2, text: "Show what we have", desc: "bkajksjfhjkhs dfgdfg fg dfg dfg. Ljkdjfks akslfd.", state: 1},
            {id: 3, text: "Create offer", desc: "bkajksjfhjkhs", state: 0},{id: 4, text: "Sign the deal", desc: "bkajksjfhjkhs asdasd asd asd asd asdasdasdgf ", state: 0}]
        }
        
        function init(){
            var processContainer = document.getElementById("processContainer");
            for(var field of dataObj.optionSet){
                processContainer.appendChild(htmlToElements(createArrow(field.text, field.id)))
            }
        }

        function createArrow(name, value){
            var arrowHtml = "<div id="+ value + " class=\"processArrowContainer\" onclick=\"arrowClicked(this.id)\">"
            + "<div class=\"arrow left\"></div>"
            + "<div class=\"arrow center\">" + name + "</div>"
            + "<div class=\"arrow right\"></div>"
            + "</div>";
            return arrowHtml;
        }

        /**
        * @param {String} HTML representing any number of sibling elements
        * @return {NodeList} 
        */
        function htmlToElements(html) {
            var template = document.createElement('template');
            html = html.trim();
            template.innerHTML = html;
            return template.content.firstChild;
        }

        function loadData(){
            // Request WF configuration from JS
            return dataObj;
        }

        function arrowClicked(elementId){
            console.log(event);

            // if rule validation passed
            setArrowCssClass(elementId);
        }

        function setArrowCssClass(elementId){
            var element = document.getElementById(elementId);
            var state = "active";
            if(element && element.classList.contains(state)){
                element.classList.remove(state);
                for(var node of element.childNodes){
                    node.classList.remove(state);
                }
                state = "completed";                
            }
                
            if(!element.classList.contains(state)){
                element.classList.add(state);
                for(var node of element.childNodes){
                    node.classList.add(state);
                }
            }
        }
    </script>
    <div id="processContainer" class="processContainer">
    </div>
    
</body>